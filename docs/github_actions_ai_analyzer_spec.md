# GitHub Actions AI Analyzer - 詳細仕様書

## 1. プロジェクト概要

### 1.1 目的

GitHub Actionsのワークフロー実行で発生するエラーログを構造化・最適化し、AIによる効果的な改善案生成を支援するライブラリ・ツールの開発。

### 1.2 背景

- GitHub Actionsのエラーログは大量のノイズを含み、AIが根本原因を特定するのが困難
- エラーが複数箇所に散在し、文脈情報が不足している
- 環境固有の情報や関連ファイルとの関係性が不明確
- 結果として、AIから得られる改善案が的外れになることが多い

### 1.3 解決するべき課題

- **ログのノイズ除去**: セットアップログ、無関係な警告の除去
- **エラーの構造化**: 散在するエラー情報の統合と分類
- **コンテキスト情報の補完**: ワークフロー構成、リポジトリ情報との関連付け
- **AI向け最適化**: AIが理解しやすい形でのプロンプト生成

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 ログ解析エンジン

**機能概要**: GitHub Actionsの生ログを解析し、構造化されたエラー情報を抽出

**入力**:

- GitHub Actionsの実行ログ（テキスト形式）
- ワークフローファイル（.github/workflows/\*.yml）
- リポジトリのメタデータ（package.json, requirements.txt等）

**出力**:

- 構造化されたエラー情報オブジェクト
- エラーカテゴリ分類
- 関連ファイルリスト
- 環境情報

**処理内容**:

- ログの前処理（不要な情報の除去、タイムスタンプの正規化）
- エラーメッセージの抽出と分類
- 重要度レベルの判定（fatal, error, warning, info）
- 関連するワークフローステップとの紐付け

#### 2.1.2 パターンマッチングシステム

**機能概要**: 既知のエラーパターンとのマッチングによる高速な原因特定

**パターンカテゴリ**:

- **依存関係エラー**: パッケージの不整合、バージョン競合
- **権限エラー**: ファイルアクセス権限、実行権限の問題
- **環境エラー**: コマンド不足、PATH設定の問題
- **ネットワークエラー**: タイムアウト、接続エラー
- **構文エラー**: YAML構文、スクリプト構文の問題

**マッチング手法**:

- 正規表現による高精度パターンマッチング
- 言語・フレームワーク固有のパターン適用
- エラーメッセージの類似度計算
- 複数パターンの組み合わせ検出

#### 2.1.3 コンテキスト収集システム

**機能概要**: エラーの背景情報を収集し、AI解析の精度向上に寄与

**収集情報**:

- **ワークフロー情報**: トリガー条件、実行戦略、使用アクション
- **リポジトリ情報**: 主要言語、フレームワーク、パッケージマネージャー
- **実行環境情報**: ランナーOS、ランタイムバージョン、インストール済みツール
- **関連ファイル**: 設定ファイル、依存関係定義ファイル

**データソース**:

- GitHub APIからのリポジトリメタデータ
- ワークフローファイルの静的解析
- ログからの実行環境情報抽出
- ファイルシステムからの設定ファイル読み込み

#### 2.1.4 AI プロンプト最適化エンジン

**機能概要**: 構造化されたエラー情報をAIが理解しやすい形式に変換

**最適化処理**:

- エラーメッセージのクリーンアップ（スタックトレースの整理）
- 重要な情報の強調表示
- 関連コンテキストの適切な配置
- 求める回答形式の明確化

**プロンプトテンプレート**:

- エラー解析用テンプレート
- 解決策生成用テンプレート
- ベストプラクティス提案用テンプレート
- 予防策提案用テンプレート

### 2.2 言語・フレームワーク固有機能

#### 2.2.1 Python サポート

**対応範囲**:

- pip, poetry, venv による依存関係管理
- requirements.txt, pyproject.toml の解析
- Python バージョン互換性問題
- Django, Flask 等のフレームワーク対応

**固有エラーパターン**:

- pip install の失敗パターン
- import エラー
- Python 2/3 互換性問題
- 仮想環境の設定問題

#### 2.2.2 JavaScript/Node.js サポート

**対応範囲**:

- npm, yarn, pnpm による依存関係管理
- package.json, package-lock.json の解析
- Node.js バージョン固有の問題検出
- TypeScript, React, Next.js 等のフレームワーク対応

**固有エラーパターン**:

- npm install の失敗パターン
- モジュール解決エラー
- TypeScript コンパイルエラー
- ESLint, Prettier 設定エラー

#### 2.2.3 Java サポート

**対応範囲**:

- Maven, Gradle によるビルド管理
- pom.xml, build.gradle の解析
- JDK バージョン固有の問題
- Spring Boot 等のフレームワーク対応

**固有エラーパターン**:

- コンパイルエラー
- 依存関係の競合
- テスト実行エラー
- JAR パッケージング問題

### 2.3 出力・レポート機能

#### 2.3.1 構造化データ出力

**フォーマット**:

- JSON: プログラムからの利用に適した形式
- YAML: 人間が読みやすい形式
- XML: 他システムとの連携用

**含まれる情報**:

- エラーの詳細分析結果
- 推定される根本原因
- 関連ファイルとの関係性
- 優先度付きの改善提案

#### 2.3.2 レポート生成

**Markdown レポート**:

- GitHub Issues への貼り付けに適した形式
- 段階的な解決手順の記載
- 関連リンクとリソースの提供

**HTML レポート**:

- ブラウザでの閲覧に適した形式
- インタラクティブな要素の提供
- 視覚的なエラー箇所のハイライト

**プレーンテキスト**:

- ターミナルでの表示に適した形式
- 色分けによる重要度の表示
- 簡潔な改善提案

### 2.4 CLI機能

#### 2.4.1 基本コマンド

**analyze コマンド**:

- 用途: ログファイルの解析実行
- 引数: ログファイルパス、ワークフローファイルパス
- オプション: 出力フォーマット、詳細レベル、言語指定

**validate コマンド**:

- 用途: ワークフローファイルの事前検証
- 引数: ワークフローファイルパス
- オプション: 厳密性レベル、チェック項目の選択

**watch コマンド**:

- 用途: ログファイルの変更監視と自動解析
- 引数: 監視対象ディレクトリ
- オプション: 監視間隔、通知方法

#### 2.4.2 設定管理

**設定ファイル**:

- グローバル設定: ~/.gh-actions-analyzer/config.yml
- プロジェクト設定: .gh-actions-analyzer.yml
- 環境変数による設定上書き

**設定項目**:

- デフォルト出力フォーマット
- 言語固有の設定
- AI サービスの設定
- ログレベルの設定

## 3. 非機能要件

### 3.1 性能要件

**処理速度**:

- 10MB以下のログファイル: 5秒以内で解析完了
- 基本的なパターンマッチング: 1秒以内
- AI プロンプト生成: 2秒以内

**メモリ使用量**:

- ピーク時でも 256MB 以下
- 大きなログファイルはストリーミング処理で対応

**スケーラビリティ**:

- 複数ログファイルの並列処理対応
- パターンデータベースの動的拡張

### 3.2 信頼性要件

**エラーハンドリング**:

- 不正なログファイルに対する適切なエラーメッセージ
- 部分的なエラーでも可能な範囲で解析継続
- 解析失敗時の詳細なデバッグ情報提供

**データ整合性**:

- パターンマッチングの精度向上メカニズム
- 誤検出の最小化
- 検出漏れの防止策

### 3.3 互換性要件

**プラットフォーム対応**:

- Python 3.8 以降
- Node.js 16.x 以降
- Windows, macOS, Linux での動作
- GitHub Codespaces での利用

**外部サービス連携**:

- GitHub API との連携
- 主要AI サービス（OpenAI, Anthropic, etc.）との互換性
- CI/CD パイプラインへの組み込み

### 3.4 セキュリティ要件

**データ保護**:

- ログファイル内の機密情報の自動検出・マスキング
- 外部サービスへの送信データの最小化
- ローカル処理オプションの提供

**アクセス制御**:

- GitHub トークンの安全な管理
- 設定ファイルの適切な権限設定
- 一時ファイルの安全な削除

## 4. システム設計

### 4.1 アーキテクチャ概要

**レイヤー構成**:

- **プレゼンテーション層**: CLI, Web API
- **アプリケーション層**: 解析オーケストレーション
- **ドメイン層**: コアビジネスロジック
- **インフラストラクチャ層**: ファイルIO, 外部API連携

**設計パターン**:

- プラグインアーキテクチャによる言語サポート拡張
- ストラテジーパターンによるパターンマッチング切り替え
- オブザーバーパターンによる解析進捗通知

### 4.2 データフロー

**解析フロー**:

1. ログファイル読み込み
2. 前処理（ノイズ除去、正規化）
3. パターンマッチング実行
4. コンテキスト情報収集
5. 構造化データ生成
6. AI プロンプト最適化
7. 結果出力

**データ変換**:

- 生ログ → クリーンログ → 構造化データ → AI最適化プロンプト

### 4.3 拡張性設計

**プラグインシステム**:

- 新しい言語サポートの追加
- カスタムパターンの定義
- 出力フォーマットの拡張

**設定駆動設計**:

- パターン定義の外部ファイル化
- テンプレートのカスタマイズ
- ルールエンジンによる柔軟な条件分岐

## 5. 開発・運用

### 5.1 開発方針

**技術スタック**:

- Python: 豊富なライブラリエコシステムと開発効率
- TypeScript: 型安全性と開発効率の両立
- Node.js: クロスプラットフォーム対応
- Jest: 包括的なテスト環境
- ESLint/Prettier: コード品質の維持

**テスト戦略**:

- ユニットテスト: 各モジュールの個別テスト
- 統合テスト: エンドツーエンドの動作確認
- パフォーマンステスト: 大量ログファイルでの性能検証

### 5.2 品質保証

**静的解析**:

- TypeScript による型チェック
- ESLint による潜在的問題の検出
- SonarQube による品質メトリクス監視

**動的テスト**:

- 実際のGitHub Actionsログを用いた回帰テスト
- 異常系テストの充実
- パフォーマンス回帰テスト

### 5.3 リリース戦略

**バージョニング**:

- セマンティックバージョニングの採用
- 破壊的変更の事前通知
- 段階的な機能廃止プロセス

**配布方法**:

- PyPI パッケージとしての配布
- npm パッケージとしての配布
- GitHub Releases での実行ファイル配布
- Docker イメージでの提供

## 6. ユーザビリティ

### 6.1 対象ユーザー

**プライマリユーザー**:

- GitHub Actions を使用する開発者
- CI/CD パイプラインの運用担当者
- DevOps エンジニア

**想定スキルレベル**:

- 基本的なGitHub Actions の知識
- コマンドライン操作の経験
- 使用言語・フレームワークの基礎知識

### 6.2 使いやすさの要件

**学習コストの最小化**:

- 直感的なコマンド体系
- 豊富な使用例の提供
- 段階的な機能習得の支援

**エラー メッセージの改善**:

- 問題の原因を明確に示す
- 解決手順を具体的に提示
- 関連ドキュメントへのリンク提供

### 6.3 ドキュメント要件

**API ドキュメント**:

- 全ての公開インターフェースの詳細仕様
- 実用的なコード例
- パラメータと戻り値の明確な説明

**ユーザーガイド**:

- クイックスタートガイド
- 用途別の使用例
- トラブルシューティングガイド

**開発者向けドキュメント**:

- アーキテクチャ概要
- 拡張機能の開発方法
- コントリビューションガイド
